import copy

import numpy as np

# 3x3x1 grid of fODF taken from the outside of the backwards 'C'
# in the FiberCup. Order 8, descoteaux07 basis.
fodf_3x3_order8_descoteaux07 = np.asarray([[[
    [0.26286387, -0.336828, -0.00369634, -0.25474626,
     -0.01061569, 0.29750797, 0.03732642, 0.01171304,
     0.16143565, 0.00787683, 0.14300859, 0.01041067,
     -0.13926704, -0.00285504, -0.28675956, 0.06106967,
     -0.00251915, -0.0103068, -0.00626346, -0.05204236,
     -0.00324461, -0.0468456, -0.00444966, 0.04529396,
     0.00119645, 0.07706978, 0.00584123, 0.08920382]],

    [[0.27447942, -0.38676834, -0.02799141, -0.23060161,
      -0.03448979, 0.09528257, 0.25290385, -0.01982788,
      0.22237155, 0.00135294, 0.13581508, 0.01650201,
      -0.0275899, 0.00186949, -0.09112225, -0.08496156,
      0.00396445, -0.07162198, 0.00324492, -0.07831519,
      0.00616271, -0.05209329, -0.01479937, 0.01713125,
      -0.02268516, 0.04751123, -0.03049234, 0.06638705]],

    [[0.27134237, -0.4307746, 0.0035063, -0.2592252,
      -0.00330402, -0.15647785, 0.21888971, 0.00334128,
      0.22812255, 0.01228249, 0.16825177, 0.00471007,
      0.08927008, 0.00575425, 0.19901836, -0.04885881,
      -0.00579403, -0.07190462, -0.00737415, -0.08707161,
      -0.00195517, -0.06621928, -0.00356173, -0.03289294,
      -0.00356576, -0.06258938, -0.00665118, -0.09943768]]],


    [[[0.15886374, 0.01589506, 0.06487983, -0.02096088,
       0.02011732, 0.00589444, 0.03856898, 0.00757658,
       0.05849233, -0.11192703, 0.00713574, -0.00371081,
       -0.0244258, 0.0117896, 0.03056652, -0.01305971,
       0.00679529, -0.01269033, -0.00467887, -0.01755827,
       -0.00761302, 0.02157611, 0.02873131, -0.01170345,
       0.00136947, -0.00745852, 0.02145799, 0.00045532]],

     [[0.17820162, -0.08854709, -0.0138819, -0.08386812,
       0.04722548, -0.03020687, 0.03683474, 0.0020233,
       0.02984233, -0.07024448, 0.04935116, 0.05288185,
       -0.06069153, -0.02227145, -0.08536565, -0.00739656,
       -0.00208759, -0.03538536, 0.04175738, -0.01890082,
       0.03184003, -0.04322833, -0.0197769, -0.01709824,
       0.03408453, 0.03452914, -0.00768105, 0.02879811]],

     [[0.17783499, -0.08317029, 0.02127749, -0.05431161,
       -0.0426516, 0.00668156, -0.10225131, 0.05116061,
       0.05691102, 0.06157963, 0.08037782, -0.0264888,
       0.0032487, 0.00127227, -0.00224557, 0.08135595,
       -0.00129513, 0.04060476, -0.00118032, -0.00987782,
       0.00490772, -0.03195551, -0.01908543, -0.03024822,
       -0.00608355, -0.01933366, 0.00161467, -0.00429689]]],

    [[[0., 0., 0., 0.,
       0., 0., 0., 0.,
       0., 0., 0., 0.,
       0., 0., 0., 0.,
       0., 0., 0., 0.,
       0., 0., 0., 0.,
       0., 0., 0., 0.]],

     [[0., 0., 0., 0.,
       0., 0., 0., 0.,
       0., 0., 0., 0.,
       0., 0., 0., 0.,
       0., 0., 0., 0.,
       0., 0., 0., 0.,
       0., 0., 0., 0.]],

     [[0., 0., 0., 0.,
       0., 0., 0., 0.,
       0., 0., 0., 0.,
       0., 0., 0., 0.,
       0., 0., 0., 0.,
       0., 0., 0., 0.,
       0., 0., 0., 0.]]]])

fodf_3x3_order8_descoteaux07_filtered_unified = np.array([
    [[[2.29357947e-01, -3.40501584e-03, -6.99261017e-04,
        -7.19531128e-03, -2.82538626e-01, 1.39868002e-03,
        -2.13735138e-01, -6.60276345e-03, 2.40092790e-01,
        -6.49857556e-03, -1.47142046e-03, -1.74323477e-03,
        1.97528288e-03, 2.74056237e-03, 1.40669684e-03,
        8.45362867e-03, 4.87161977e-02, 3.29667207e-03,
        1.56340999e-01, -4.53684466e-03, 1.36801062e-01,
        5.76189638e-03, -1.35952240e-01, 7.04539644e-03,
        -2.80666044e-01, 2.01464026e-03, -3.04351606e-03,
        2.55501754e-03, 1.77060275e-03, 1.66821237e-03,
        -4.83733413e-04, 1.34162234e-03, -1.88498937e-03,
        -8.92315295e-04, -1.85175590e-03, -9.90733681e-03,
        7.96610117e-02, -6.93678171e-03, -1.32213544e-02,
        9.29201219e-04, -6.76385227e-02, 3.24539565e-03,
        -6.21090167e-02, 1.48437903e-04, 6.24298982e-02,
        -6.98251925e-03, 1.09354237e-01, -7.46142122e-03,
        1.39128340e-01]],

        [[2.23049655e-01, -6.34489485e-04, -2.46164995e-04,
          1.11559735e-03, -3.33977838e-01, -5.91911022e-03,
          -2.00774725e-01, -2.42845691e-02, 7.05612574e-02,
          -1.39213801e-02, -1.23520352e-03, -2.34371080e-03,
          1.91758690e-03, 8.65363592e-04, 1.02889761e-03,
          4.72826644e-03, 2.33056470e-01, -1.02386226e-03,
          1.93300973e-01, -9.51278280e-04, 1.29224787e-01,
          3.09759106e-02, -3.46205350e-02, 2.24824994e-02,
          -9.29648766e-02, 1.38485242e-02, -4.48354553e-04,
          4.43312110e-03, 1.23785504e-03, 1.47203519e-04,
          -1.48610994e-03, -1.48539730e-03, -1.71649289e-03,
          -1.24889989e-03, 8.08452709e-04, -5.42925265e-03,
          -1.06615393e-01, 5.72984074e-04, -8.65200925e-02,
          5.99094215e-04, -8.35112741e-02, 9.02314727e-04,
          -5.75274392e-02, -3.27219474e-02, 1.61903376e-02,
          -3.03618703e-02, 3.50629229e-02, -3.12781970e-02,
          6.09901309e-02]],

        [[2.39271129e-01, -1.29514017e-03, 2.67539048e-05,
          7.77199752e-03, -3.65455973e-01, 1.59433374e-03,
          -2.30378736e-01, -1.71148930e-03, -1.31054065e-01,
          -6.63373599e-03, -2.62685328e-03, -1.54850825e-03,
          -1.04405158e-03, -8.82561059e-04, -8.40336616e-04,
          -4.02329843e-03, 2.14542732e-01, 9.81212746e-04,
          2.25362349e-01, 1.70438428e-03, 1.68648111e-01,
          1.72316326e-03, 8.47390835e-02, -1.94316083e-03,
          1.81578935e-01, 1.24860810e-02, 8.35937367e-04,
          3.26296874e-03, 1.87537964e-03, 1.16841921e-04,
          1.56804161e-03, -3.77935733e-03, 5.18925927e-04,
          -1.17750904e-03, 2.33482491e-03, 5.33718948e-03,
          -6.84234291e-02, -7.23686798e-03, -9.02332211e-02,
          -4.07916322e-03, -1.21786755e-01, -4.40776431e-04,
          -9.72842248e-02, -2.05488288e-04, -4.92693194e-02,
          1.53163774e-03, -8.40887907e-02, 1.18279868e-03,
          -1.15965859e-01]]],


    [[[4.90583299e-02, 1.42501402e-03, -8.36557553e-04,
       -1.15831440e-02, -4.22656583e-03, 1.77363767e-02,
       -1.31061492e-02, 6.58267947e-03, 3.57744477e-03,
       -1.19818257e-03, 7.13707057e-04, 1.00507324e-04,
       -4.05178649e-05, 5.72719299e-03, -8.62838694e-04,
       6.93407399e-03, 1.28787065e-02, 3.71612264e-03,
       1.84145755e-02, -3.03712343e-02, 4.27460381e-03,
       -1.05287718e-03, -6.81217935e-03, 2.91621036e-03,
       7.67712088e-03, -1.67774735e-03, -9.17083386e-04,
       -7.05515351e-04, -2.57881938e-04, -5.39230247e-05,
       5.44975228e-04, -2.91389651e-03, 2.49849340e-03,
       -2.18778612e-03, 4.26276808e-04, -1.88276038e-03,
       -3.92622090e-03, 3.22745694e-03, -2.49579185e-03,
       -5.16371150e-04, -7.14925457e-03, -3.53600795e-04,
       6.22853770e-03, 6.75767637e-03, -4.95233255e-03,
       1.00070512e-03, -5.30703269e-04, 7.75615036e-03,
       2.13095937e-04]],

        [[6.83494656e-02, 2.47590868e-03, 8.04082443e-04,
          -1.07085124e-03, -4.66462691e-02, -3.14996372e-03,
          -3.67278245e-02, 1.24317997e-02, 2.84904197e-04,
          -3.67900721e-03, -2.45262880e-03, -1.25632506e-03,
          -3.29065414e-04, 1.34005377e-03, 2.27011899e-03,
          1.12787213e-04, 1.57892279e-02, -6.42922533e-04,
          2.23863221e-02, -1.98960014e-02, 2.30945595e-02,
          1.22861979e-02, -2.09248819e-02, -7.79075565e-03,
          -3.12206640e-02, 6.21542463e-05, 2.42862058e-04,
          1.12858477e-03, 1.19409512e-03, 2.01720154e-04,
          9.41874244e-04, -1.50090832e-03, -2.70566377e-03,
          2.13984489e-03, -2.74112863e-03, 4.67208319e-03,
          -2.84238532e-03, 1.19886439e-03, -1.42714247e-02,
          1.35054050e-02, -1.26888266e-02, 8.93556030e-03,
          -1.69535796e-02, -3.44881983e-03, -3.29416809e-03,
          1.15606070e-02, 1.51758509e-02, -2.17242328e-03,
          1.61578521e-02]],

        [[6.20684558e-02, 2.29537210e-03, 1.57782979e-04,
          1.21746858e-02, -3.75416568e-02, 3.57151832e-03,
          -2.99229041e-02, -1.04691005e-02, 7.93762774e-04,
          -8.24432299e-03, -8.34753632e-04, -2.42344377e-03,
          1.20899492e-03, -5.68896102e-03, 4.33085595e-04,
          -4.85994374e-03, -3.41545076e-02, 1.46092528e-02,
          2.35147496e-02, 1.53551134e-02, 3.09649758e-02,
          -3.32700724e-03, 7.38885638e-04, -5.33398930e-04,
          -2.20765157e-03, 4.73109351e-03, 8.27559708e-04,
          4.68404939e-03, -2.84124885e-04, 1.27799454e-03,
          -1.45038536e-03, 2.38853146e-03, -1.98245860e-03,
          2.58454776e-03, -6.55298954e-04, 1.39578469e-03,
          3.98648608e-02, -1.91019079e-03, 1.58616283e-02,
          -2.31384838e-03, -6.71152510e-03, 8.87343339e-04,
          -1.49804902e-02, -7.65802177e-03, -1.06220121e-02,
          -1.99364911e-03, -4.93716710e-03, 1.93583996e-03,
          2.37014751e-03]]],


    [[[8.56465561e-03, 7.14008949e-03, 9.31430807e-04,
       -3.60053409e-03, 3.43419984e-04, 2.32896514e-03,
       -3.29158998e-03, 6.33322848e-04, -1.41612004e-03,
       -1.96906728e-05, 2.08462933e-03, -4.70169796e-04,
       -3.18806182e-03, 7.96508703e-04, 1.69068438e-04,
       8.53310802e-04, 7.43969959e-04, 6.92280373e-04,
       1.56785435e-03, -4.36363329e-03, 8.41585833e-04,
       7.77737118e-04, -8.43136432e-04, -2.88294327e-04,
       4.52821928e-04, 2.30036728e-04, -1.17694055e-04,
       3.29426513e-04, -1.69867522e-03, -1.36557340e-04,
       2.43068996e-03, -5.02415966e-04, 1.08299347e-03,
       -9.28927692e-04, -4.96423591e-05, 9.66391487e-05,
       -7.75296465e-05, -7.81383154e-05, -3.84702522e-04,
       1.38600809e-04, -1.24402688e-04, 1.24713482e-03,
       -4.63949171e-05, -1.84301807e-04, -5.34927571e-04,
       6.78179065e-04, -4.90089799e-04, 3.53365269e-04,
       -2.82389612e-04]],

        [[1.00402920e-02, 7.58354607e-03, 8.90893563e-04,
          -1.28660192e-03, -1.33702532e-03, 1.36204823e-03,
          -4.63267660e-03, 6.65906190e-04, -1.62515435e-03,
          -2.18256882e-03, 8.05148913e-04, -1.99928992e-03,
          -1.83230347e-03, -1.09679838e-05, 9.06606032e-04,
          -1.63774703e-03, -7.68655802e-04, 5.10504917e-04,
          1.39995532e-03, -2.66336265e-03, 2.41858563e-03,
          8.60507816e-05, -3.95330794e-04, -2.54730514e-04,
          -7.51359487e-04, 9.56600867e-05, 2.33861137e-04,
          9.07833792e-04, -9.61201431e-04, 1.28055532e-03,
          1.78347418e-03, -4.80643827e-04, 2.17566393e-05,
          3.30969135e-04, -9.77124047e-04, 4.48248320e-04,
          7.68020370e-04, -9.77999769e-05, -4.11722548e-05,
          4.91272506e-04, 3.40984634e-04, 1.23504466e-03,
          -8.25409359e-04, -9.52547943e-05, -1.01083781e-03,
          6.74211675e-04, 1.26126637e-04, -4.93598622e-04,
          -4.93061797e-05]],

        [[7.32812182e-03, 4.68891712e-03, 7.34380826e-04,
          3.29422628e-03, -2.95965884e-03, 7.20124038e-04,
          -3.21578559e-03, -1.79025321e-04, 1.01238881e-03,
          -4.08613875e-03, 5.58987071e-04, -1.23820537e-03,
          2.40328249e-04, -1.56967169e-03, -1.39154716e-04,
          -1.34541481e-03, -2.15931028e-03, 9.24919733e-04,
          1.77585704e-03, 3.15205162e-04, 2.14559276e-03,
          -2.47588632e-04, -9.18796674e-04, -3.64654434e-04,
          -1.39549298e-03, -1.32647212e-04, 8.84594449e-04,
          1.97716001e-03, 2.69772753e-04, 1.19616199e-03,
          -3.84616915e-04, 3.64541696e-04, -7.01064946e-04,
          2.94422528e-04, -4.42401101e-04, -4.55646206e-04,
          1.19246383e-03, 4.13058489e-04, 1.06265511e-03,
          6.72362107e-04, 2.49843251e-04, 2.46282871e-04,
          -6.64883205e-04, -1.99434148e-04, -3.93359154e-04,
          1.76576846e-05, 3.28426158e-04, -3.16710533e-04,
          5.22099584e-05]]]])

fodf_3x3_order8_descoteaux07_filtered_cosine = np.array([[
    [[1.10403600e-01, -1.56274168e-02, -1.76220261e-03, -4.06611449e-02,
      -1.30363567e-01, 3.75744696e-03, -9.97133892e-02, -3.49429274e-03,
      9.52583150e-02, 8.20238612e-03, -4.89889718e-03, 2.97695306e-03,
      4.70504991e-03, 2.74152194e-02, -1.06442787e-03, 3.09297306e-02,
      3.78406501e-02, 4.40385732e-03, 6.97472214e-02, -5.22356452e-03,
      5.54510683e-02, 4.19701656e-03, -4.61628754e-02, 1.04670478e-03,
      -9.23817078e-02, -1.08910148e-02, 5.21920978e-04, -6.08726863e-03,
      5.44869381e-03, -2.53482527e-04, -2.27573225e-03, -1.40288007e-02,
      1.35667761e-03, -1.30331232e-02, 5.35207622e-04, -1.63039610e-02,
      7.97932344e-03, 8.02639457e-04, -1.21136261e-02, -1.83430175e-03,
      -2.54608366e-02, 9.91489623e-04, -1.97747572e-02, -1.75031223e-03,
      1.49128199e-02, -1.43106403e-03, 2.66094509e-02, 8.57021815e-04,
      3.30743534e-02]],

    [[1.40072235e-01, 3.36392275e-03, -1.12255448e-04, -5.78225308e-03,
      -1.77192188e-01, -6.19144118e-03, -1.17119585e-01, -1.16353192e-02,
      3.66205780e-02, -3.46907611e-02, -3.57179047e-03, -9.03952453e-03,
      3.77892854e-03, 7.63422898e-03, 1.62939211e-03, 1.45448683e-02,
      9.98680216e-02, -2.60934868e-03, 1.02401140e-01, -3.99776516e-03,
      6.98372955e-02, 8.57505830e-03, -1.55541774e-02, -6.67052505e-04,
      -3.87320367e-02, 2.70807684e-02, 4.61517902e-04, 1.48157281e-02,
      2.48281726e-03, 3.77428961e-03, -3.20783604e-03, -5.32528133e-03,
      -4.66592653e-03, -4.11151389e-03, 1.53491240e-04, -6.28303818e-03,
      -2.60040931e-02, 9.76421739e-04, -3.20749919e-02, 6.17639701e-04,
      -3.80348770e-02, 3.50055436e-03, -2.89460088e-02, -6.21961773e-03,
      6.33647814e-03, -3.64798932e-03, 1.61175330e-02, -8.68729069e-03,
      1.87904410e-02]],

    [[1.14020750e-01, -6.87045764e-03, -1.14232450e-03, 4.11661189e-02,
      -1.63423278e-01, 1.42638757e-03, -1.02391114e-01, -3.10274637e-03,
      -4.14102976e-02, -7.65200269e-05, -1.22479669e-03, 1.44271152e-04,
      1.02909411e-03, -2.53524591e-02, 8.46680097e-04, -2.91525407e-02,
      8.15595775e-02, 2.62140564e-03, 8.88886643e-02, 3.47353540e-03,
      6.60543440e-02, 4.57053464e-03, 2.22276194e-02, 1.59968571e-03,
      4.74753501e-02, 9.57052289e-03, -2.72297788e-03, 7.60147678e-04,
      -2.24030127e-03, -2.25223735e-03, -1.58726069e-03, 1.44355725e-02,
      -2.65302865e-03, 1.43794907e-02, -7.26650570e-04, 1.72575124e-02,
      -2.26407370e-02, -3.96339977e-05, -2.79391904e-02, 1.96495129e-04,
      -3.42417083e-02, 5.69135891e-04, -2.83188289e-02, -3.90851596e-03,
      -9.86179763e-03, -1.53911048e-03, -1.44494506e-02, -3.56561464e-03,
      -2.28537982e-02]]],

    [[[7.26406236e-02, 7.02981930e-03, -1.87881430e-03, -1.61256813e-02,
     -2.64719814e-02, 1.79623468e-02, -2.81063801e-02, 6.54603124e-03,
     1.45408540e-02, -1.01358115e-02, 4.89154209e-04, -2.90726497e-03,
     -5.52737463e-04, 8.21197934e-03, -1.38576779e-03, 1.91516929e-02,
     1.90580115e-02, 1.39116265e-03, 3.21379718e-02, -3.41384306e-02,
     1.56080311e-02, 2.17425083e-03, -1.61882394e-02, 2.30982768e-03,
     -4.68867105e-03, -6.71668742e-04, -1.23223614e-04, 2.34797057e-03,
     1.21306862e-03, 1.70700484e-03, 2.32198084e-03, -5.41906023e-03,
     4.33958103e-03, -8.72831333e-03, 4.65559442e-04, -1.77434743e-02,
     -3.67747484e-03, 2.22363618e-03, -6.92884020e-03, 1.54291482e-03,
     -1.17597007e-02, -7.95446846e-04, -9.29108890e-05, 6.00740874e-03,
     -8.13945278e-04, 6.46410176e-04, 3.25235814e-03, 5.35093467e-03,
     1.94505156e-03]],

     [[9.81325940e-02, 1.52165204e-02, 1.24419995e-03, -1.28939516e-03,
       -7.51292526e-02, -4.42181788e-03, -6.18455506e-02, 1.09682359e-02,
       1.47464674e-03, -3.31177366e-02, -2.92832122e-03, -1.02011317e-02,
       3.94651358e-04, 2.74508980e-03, 3.55769102e-03, 4.53198680e-03,
       1.65537934e-02, 6.31128591e-04, 3.60410320e-02, -2.02268925e-02,
       3.71610204e-02, 1.50104427e-02, -2.10404071e-02, -6.66322009e-03,
       -2.82880695e-02, 2.37099397e-02, 4.67322046e-04, 1.69550184e-02,
       7.12799550e-04, 5.70549692e-03, 8.82880626e-04, -3.97702624e-03,
       -4.87365758e-03, 1.15246875e-03, -2.71843590e-03, 1.70523580e-03,
       8.22004027e-03, -2.16495266e-03, -1.35291214e-02, 1.12046159e-02,
       -1.70833051e-02, 9.56991767e-03, -2.20789814e-02, -5.21140434e-03,
       -5.63453210e-03, 9.14118089e-03, 1.07848139e-02, -2.44076209e-03,
       7.20372163e-03]],

     [[7.82262155e-02, 4.89325589e-03, 9.69035921e-04, 2.48817773e-02,
       -5.77909247e-02, 5.15396685e-03, -3.73859556e-02, -1.12652597e-02,
       1.46133523e-03, -1.93929247e-02, -1.66098338e-03, -5.40552612e-03,
       1.90785108e-03, -1.27736588e-02, -2.63140561e-04, -1.64589849e-02,
       -1.67926849e-02, 1.37226384e-02, 3.40286811e-02, 1.60456988e-02,
       3.66665622e-02, -4.95865979e-03, -8.81294607e-04, -9.27511404e-04,
       -5.56159406e-03, 1.85807717e-02, 4.28397297e-05, 1.14440177e-02,
       -8.44202079e-04, 2.83058074e-03, -2.77968111e-03, 7.24897169e-03,
       -3.92705015e-03, 8.88560041e-03, -1.14740758e-03, 1.25959122e-02,
       2.28839936e-02, -6.30383042e-04, 6.79235888e-03, 2.74534443e-03,
       -1.08549693e-02, 2.89646379e-03, -1.59780244e-02, -7.49181391e-03,
       -9.15354118e-03, -1.60175812e-03, -1.81015916e-03, -7.74073756e-04,
       5.32445729e-03]]],

    [[[1.34755663e-02, 1.28413970e-02, 1.49938841e-03, -6.47475638e-03,
     2.52029988e-03, 4.88968824e-03, -5.42289754e-03, 1.60941684e-03,
     -2.21852068e-03, 2.07330837e-03, 4.86536226e-03, 1.66978774e-04,
     -6.71214109e-03, 1.27351141e-03, 9.82399935e-04, 2.22677827e-03,
     2.71719965e-03, 2.06634356e-03, 2.94252961e-03, -8.67336125e-03,
     3.55625935e-04, 1.36775123e-03, -2.08127408e-03, 2.52009045e-04,
     -1.49716310e-04, -3.07585778e-04, 1.29094098e-04, -1.78327891e-04,
     -3.55467543e-03, -1.03702801e-03, 5.01705916e-03, -1.46068291e-03,
     2.29931595e-03, -2.32968172e-03, 7.43670432e-04, -6.92986861e-04,
     -1.00498143e-03, 2.95173070e-05, -1.53450925e-03, 3.21191049e-04,
     -1.58863466e-03, 2.65016963e-03, -4.11708281e-04, -7.87924032e-04,
     -8.33831423e-04, 1.07967881e-03, 2.63612367e-04, 9.87115809e-04,
     1.21380213e-03]],

     [[1.61478356e-02, 1.43728777e-02, 1.93974718e-03, -3.32623522e-03,
       -1.17420191e-03, 3.21700718e-03, -8.75686341e-03, 1.37117517e-03,
       -4.32829335e-03, -4.42773363e-03, 2.38329302e-03, -3.33902113e-03,
       -4.12497515e-03, -6.89667443e-05, 2.41897821e-03, -4.26942050e-03,
       -1.74191884e-03, 1.81570155e-03, 3.17867090e-03, -5.10889033e-03,
       4.49678511e-03, -2.60849304e-04, 1.84832760e-05, 4.61673598e-04,
       -1.52379129e-03, 9.91300908e-04, 9.15433033e-04, 2.68803221e-03,
       -2.02188630e-03, 2.73531219e-03, 3.98791591e-03, -1.49808319e-03,
       3.31828949e-04, 6.51188325e-04, -1.63160178e-03, 2.33668240e-03,
       2.93338642e-03, -5.06191672e-05, -1.03964494e-04, 3.87231978e-04,
       -8.64134554e-04, 2.56989460e-03, -2.72089308e-03, -5.28755828e-04,
       -2.52279382e-03, 1.50003583e-03, 2.73936763e-04, -7.08454308e-04,
       1.54615336e-03]],

     [[1.21073977e-02, 9.65647748e-03, 1.40513870e-03, 5.96978239e-03,
       -5.83388001e-03, 1.18491063e-03, -7.42142705e-03, -1.61753221e-04,
       2.31758132e-03, -1.01991745e-02, 1.25833161e-03, -3.28820299e-03,
       9.77997070e-04, -3.33627171e-03, -7.64652162e-04, -4.00396819e-03,
       -4.28747212e-03, 2.06971554e-03, 4.22446175e-03, 1.39004952e-03,
       5.11484010e-03, -2.51029606e-04, -1.53415978e-03, -9.05476137e-04,
       -3.72103599e-03, 1.62807768e-03, 2.07196281e-03, 5.50544884e-03,
       3.46282883e-04, 3.54274790e-03, -1.15406623e-03, 1.05391112e-03,
       -1.00296491e-03, 9.83314237e-04, -5.52227484e-04, -2.60564565e-04,
       3.63180002e-03, 1.15833727e-03, 2.31403574e-03, 6.13974106e-04,
       -7.09616975e-04, -1.19250538e-04, -3.14249677e-03, -2.51516937e-04,
       -7.67022089e-04, -3.86918453e-04, 7.29633770e-04, -1.56990164e-04,
       9.27285029e-04]]]])

# Bingham fit
fodf_3x3_bingham = np.array([[
    [[[0.8865956, -1.01305598, 0.3570712, 4.31487453, -4.09539035,
       1.50380415, -1.08597013],
      [0., 0., 0., 0., 0., 0., 0.],
      [0., 0., 0., 0., 0., 0., 0.]]],

    [[[0.85683347, -3.44257945, 0.24681098, 2.7063325, 3.0255078,
       -0.39132021, 3.88427259],
      [0.09353532, -2.07887656, -0.23646431, 2.54845777, 3.35888907,
       -12.87836086, 1.54502972],
      [0., 0., 0., 0., 0., 0., 0.]]],

    [[[0.95034369, 3.82616343, 0.66640788, 2.10370133, -2.29257285,
       -0.44777004, 4.31152262],
      [0., 0., 0., 0., 0., 0., 0.],
      [0., 0., 0., 0., 0., 0., 0.]]]],

    [[[[0.18908378, -1.3861731, 3.03919906, -1.22601547, 1.29995979,
        2.13770894, 3.82944086],
       [0.12418191, 2.74008198, -0.06444388, -1.57097804, 3.1965494,
        0.87367118, 5.53954571],
       [0.12104527, 3.61536971, -2.68105852, -1.64809093, 3.14649051,
        4.40167953, -0.25813741]]],

     [[[0.27522583, -3.48810133, 0.8774683, 1.78047152, 2.43352883,
        -0.35692355, 4.94340074],
       [0.20108258, 4.56868628, 3.66376182, 0.03988314, -3.4448441,
           4.25196219, 4.01761794],
       [0.16118525, 1.50428971, 2.4830825, 0.17002741, 1.20848685,
        -1.22853768, 7.24969027]]],

     [[[0.2612878, 4.36835975, 2.85751351, 2.79826519, -2.49064595,
        -1.38304902, 5.30046931],
       [0.23787563, -0.23406115, -0.25916585, 3.62612255, 5.29582601,
           -3.54583996, 0.08841027],
       [0.14373517, 2.05462185, 1.39279777, 0.56035226, 3.45503345,
        -6.17007375, 2.66774636]]]],

    [[[[0., 0., 0., 0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0.]]],

     [[[0., 0., 0., 0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0.]]],

     [[[0., 0., 0., 0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0.],
       [0., 0., 0., 0., 0., 0., 0.]]]]])

# Bingham array as spherical functions
fodf_3x3_bingham_sf = np.array([[[[
    [1.59484877e-01, 1.18932451e-02, 1.17911602e-02, 1.19221973e-02,
     1.79084769e-01, 1.73800247e-01],
    [0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
     0.00000000e+00, 0.00000000e+00],
    [0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
     0.00000000e+00, 0.00000000e+00]]],

    [[[4.61621144e-02, 2.12595934e-02, 6.34163521e-03, 1.00096474e-02,
       2.58251608e-01, 1.95556145e-01],
      [1.00636347e-02, 4.07760320e-05, 3.24542499e-02, 3.66369494e-03,
       2.92196637e-05, 1.47902411e-06],
      [0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
       0.00000000e+00, 0.00000000e+00]]],

    [[[1.89202646e-02, 7.72759893e-02, 1.04786067e-02, 7.41384901e-03,
       2.44206672e-01, 2.13048219e-01],
      [0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
       0.00000000e+00, 0.00000000e+00],
      [0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
       0.00000000e+00, 0.00000000e+00]]]],

    [[[[6.07104883e-02, 2.16483588e-02, 2.62426053e-03, 4.32045162e-02,
        2.64859330e-03, 9.99567222e-03],
       [4.88698419e-03, 9.58808359e-03, 2.20309972e-04, 2.60379323e-03,
        1.22570327e-02, 4.96320594e-02],
       [6.83268085e-04, 1.77794115e-03, 7.85952079e-02, 6.50364754e-03,
        1.38528228e-03, 4.95163615e-03]]],

     [[[3.03020624e-02, 5.84492588e-03, 1.15539675e-03, 3.57417939e-03,
        5.23586737e-02, 5.93138461e-02],
       [5.84873154e-04, 2.04800390e-03, 4.99198602e-02, 1.37601372e-03,
        2.97576042e-04, 2.80472189e-02],
       [1.58809156e-02, 1.10644235e-01, 2.39822852e-04, 2.29946460e-03,
        1.09010927e-02, 1.66605591e-03]]],

     [[[6.85402639e-04, 8.28014763e-02, 1.18689001e-03, 9.40716640e-04,
        1.29906371e-02, 1.64458673e-02],
       [7.72311584e-02, 4.09197783e-04, 5.93833482e-03, 4.46406166e-03,
        2.73251646e-02, 1.57738201e-02],
       [1.26632583e-02, 6.09482433e-04, 6.09099345e-03, 1.21231123e-01,
        8.59146396e-03, 3.02273873e-04]]]],

    [[[[0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
        0.00000000e+00, 0.00000000e+00],
       [0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
        0.00000000e+00, 0.00000000e+00],
       [0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
        0.00000000e+00, 0.00000000e+00]]],

     [[[0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
        0.00000000e+00, 0.00000000e+00],
       [0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
        0.00000000e+00, 0.00000000e+00],
       [0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
        0.00000000e+00, 0.00000000e+00]]],

     [[[0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
        0.00000000e+00, 0.00000000e+00],
       [0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
        0.00000000e+00, 0.00000000e+00],
       [0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
        0.00000000e+00, 0.00000000e+00]]]]])

fodf_3x3_bingham_fd = np.array([
    [[[1.47125431, 0., 0.]],
     [[1.35616136, 0.10115714, 0.]],
     [[1.50423449, 0., 0.]]],

    [[[0.35457353, 0.2050584, 0.17187861]],
     [[0.43043627, 0.22323813, 0.25806502]],
     [[0.30886279, 0.36314695, 0.24672844]]],

    [[[0., 0., 0.]],
     [[0., 0., 0.]],
     [[0., 0., 0.]]]]
)

fodf_3x3_bingham_fs = np.array([
    [[[1.65944238, 0., 0.]],
     [[1.58275955, 1.08148601, 0.]],
     [[1.58283209, 0., 0.]]],

    [[[1.87521918, 1.65127433, 1.41995313]],
     [[1.56393849, 1.11018135, 1.60104613]],
     [[1.18207888, 1.52662528, 1.71654884]]],

    [[[0., 0., 0.]],
     [[0., 0., 0.]],
     [[0., 0., 0.]]]]
)

fodf_3x3_bingham_ff = np.array([
    [[[1., 0., 0.]],
     [[0.9305868, 0.0694132, 0.]],
     [[1., 0., 0.]]],

    [[[0.48471418, 0.28032187, 0.23496396]],
     [[0.47210449, 0.24484861, 0.2830469]],
     [[0.33618151, 0.39526707, 0.26855142]]],

    [[[0., 0., 0.]],
     [[0., 0., 0.]],
     [[0., 0., 0.]]]]
)

fodf_3x3_bingham_peaks = np.array([
    [[[[-0.34397547, -0.93897366, -0.00305593],
       [0., 0., 0.],
       [0., 0., 0.]]],

     [[[0.09314371, 0.9952668, 0.02771716],
       [0.73461195, 0.26645789, 0.62397555],
       [0., 0., 0.]]],

     [[[0.17614917, -0.98432624, -0.0085624],
       [0., 0., 0.],
       [0., 0., 0.]]]],

    [[[[0.87605833, 0.22821013, -0.42478458],
       [0.04979924, -0.99058828, 0.12749469],
       [0.30605549, -0.16378166, 0.9378196]]],

     [[[0.2244257, 0.97366253, -0.04017949],
       [0.3659656, -0.46513121, 0.80605344],
       [0.84032072, -0.49375814, -0.22374984]]],

     [[[0.53356359, -0.84522153, 0.03017378],
       [0.5527576, 0.82792627, 0.09485319],
       [0.37296054, -0.18433035, -0.90935293]]]],

    [[[[0., 0., 0.],
       [0., 0., 0.],
       [0., 0., 0.]]],

     [[[0., 0., 0.],
       [0., 0., 0.],
       [0., 0., 0.]]],

     [[[0., 0., 0.],
       [0., 0., 0.],
       [0., 0., 0.]]]]]
)

# 3D array with slices 2-7 with values from 1-6 (with borders of 0)
ref_in_labels = np.zeros((10, 10, 10), dtype=np.uint16)
for i in range(2, 8):
    ref_in_labels[2:8, 2:8, i] = i - 1

# Same array with all odd slices are set to 0
ref_out_labels = copy.deepcopy(ref_in_labels)
for i in range(1, 8, 2):
    ref_out_labels[ref_out_labels == i] = 0

# mri-info log.txt output file from freesurfer input
xform = ['Volume information for mni__mask.nii.gz', 'type: nii',
         'dimensions: 193 x 229 x 193',
         'voxel sizes: 1.000000, 1.000000, 1.000000',
         'type: SHORT (4)', 'fov: 193.000', 'dof: 1',
         'xstart: -96.5, xend: 96.5', 'ystart: -114.5, yend: 114.5',
         'zstart: -96.5, zend: 96.5',
         'TR: 0.0 msec, TE: 0.0 msec, TI: 0.0 msec, flip angle: 0.0 degrees',
         'nframes: 1', 'PhEncDir: UNKNOWN', 'FieldStrength: 0.000000',
         'ras xform present',
         'xform info: x_r = 1.0000, y_r = 0.0000, z_r = 0.0000, c_r = 0.5000',
         ': x_a = 0.0000, y_a = 1.0000, z_a = 0.0000, c_a = -17.5000',
         ': x_s = 0.0000, y_s = 0.0000, z_s = 1.0000, c_s = 18.5000',
         'Orientation   : RAS', 'Primary Slice Direction: axial',
         '', 'voxel to ras transform:',
         '1.0000   0.0000   0.0000   -96.0000',
         '0.0000   1.0000   0.0000  -132.0000',
         '0.0000   0.0000   1.0000   -78.0000',
         '0.0000   0.0000   0.0000     1.0000',
         '', 'voxel-to-ras determinant 1',
         '', 'ras to voxel transform:',
         '1.0000   0.0000   0.0000    96.0000',
         '0.0000   1.0000   0.0000   132.0000',
         '0.0000   0.0000   1.0000    78.0000',
         '0.0000   0.0000   0.0000     1.0000']

# Reference matrix for xform file
xform_matrix_ref = np.array(((1, 0, 0, 0.5), (0, 1, 0, -17.5),
                             (0, 0, 1, 18.5), (0, 0, 0, 1)))
