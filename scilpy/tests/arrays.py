import copy

import numpy as np

# 3x3x1 grid of fODF taken from the outside of the backwards 'C'
# in the FiberCup. Order 8, descoteaux07 basis.
fodf_3x3_order8_descoteaux07 = np.asarray([[[
    [0.26286387, -0.336828, -0.00369634, -0.25474626,
     -0.01061569,  0.29750797,  0.03732642,  0.01171304,
     0.16143565,  0.00787683,  0.14300859,  0.01041067,
     -0.13926704, -0.00285504, -0.28675956,  0.06106967,
     -0.00251915, -0.0103068, -0.00626346, -0.05204236,
     -0.00324461, -0.0468456, -0.00444966,  0.04529396,
     0.00119645,  0.07706978,  0.00584123,  0.08920382]],

    [[0.27447942, -0.38676834, -0.02799141, -0.23060161,
      -0.03448979,  0.09528257,  0.25290385, -0.01982788,
      0.22237155,  0.00135294,  0.13581508,  0.01650201,
      -0.0275899,  0.00186949, -0.09112225, -0.08496156,
      0.00396445, -0.07162198,  0.00324492, -0.07831519,
      0.00616271, -0.05209329, -0.01479937,  0.01713125,
      -0.02268516,  0.04751123, -0.03049234,  0.06638705]],

    [[0.27134237, -0.4307746,  0.0035063, -0.2592252,
      -0.00330402, -0.15647785,  0.21888971,  0.00334128,
      0.22812255,  0.01228249,  0.16825177,  0.00471007,
      0.08927008,  0.00575425,  0.19901836, -0.04885881,
      -0.00579403, -0.07190462, -0.00737415, -0.08707161,
      -0.00195517, -0.06621928, -0.00356173, -0.03289294,
      -0.00356576, -0.06258938, -0.00665118, -0.09943768]]],


    [[[0.15886374,  0.01589506,  0.06487983, -0.02096088,
       0.02011732,  0.00589444,  0.03856898,  0.00757658,
       0.05849233, -0.11192703,  0.00713574, -0.00371081,
       -0.0244258,  0.0117896,  0.03056652, -0.01305971,
       0.00679529, -0.01269033, -0.00467887, -0.01755827,
       -0.00761302,  0.02157611,  0.02873131, -0.01170345,
       0.00136947, -0.00745852,  0.02145799,  0.00045532]],

     [[0.17820162, -0.08854709, -0.0138819, -0.08386812,
       0.04722548, -0.03020687,  0.03683474,  0.0020233,
       0.02984233, -0.07024448,  0.04935116,  0.05288185,
       -0.06069153, -0.02227145, -0.08536565, -0.00739656,
       -0.00208759, -0.03538536,  0.04175738, -0.01890082,
       0.03184003, -0.04322833, -0.0197769, -0.01709824,
       0.03408453,  0.03452914, -0.00768105,  0.02879811]],

     [[0.17783499, -0.08317029,  0.02127749, -0.05431161,
       -0.0426516,  0.00668156, -0.10225131,  0.05116061,
       0.05691102,  0.06157963,  0.08037782, -0.0264888,
       0.0032487,  0.00127227, -0.00224557,  0.08135595,
       -0.00129513,  0.04060476, -0.00118032, -0.00987782,
       0.00490772, -0.03195551, -0.01908543, -0.03024822,
       -0.00608355, -0.01933366,  0.00161467, -0.00429689]]],

    [[[0.,  0.,  0.,  0.,
       0.,  0.,  0.,  0.,
       0.,  0.,  0.,  0.,
       0.,  0.,  0.,  0.,
       0.,  0.,  0.,  0.,
       0.,  0.,  0.,  0.,
       0.,  0.,  0.,  0.]],

     [[0.,  0.,  0.,  0.,
       0.,  0.,  0.,  0.,
       0.,  0.,  0.,  0.,
       0.,  0.,  0.,  0.,
       0.,  0.,  0.,  0.,
       0.,  0.,  0.,  0.,
       0.,  0.,  0.,  0.]],

     [[0.,  0.,  0.,  0.,
       0.,  0.,  0.,  0.,
       0.,  0.,  0.,  0.,
       0.,  0.,  0.,  0.,
       0.,  0.,  0.,  0.,
       0.,  0.,  0.,  0.,
       0.,  0.,  0.,  0.]]]])

fodf_3x3_order8_descoteaux07_filtered = np.asarray([[[[
    5.99904145e-02, -7.74841521e-03, -8.85743552e-04,
    -2.43733904e-02, -6.71300622e-02,  1.40698629e-03,
    -5.02532006e-02, -1.31764043e-03,  4.39820686e-02,
    3.04767348e-03, -2.60659751e-03,  1.19609175e-03,
    2.45643515e-03,  1.60415663e-02, -3.71781262e-04,
    1.72503732e-02,  1.87847737e-02,  1.81510421e-03,
    3.45741639e-02, -4.08627879e-03,  2.70963242e-02,
    2.48334799e-03, -2.08282714e-02, -5.04963363e-05,
    -4.04026968e-02, -4.17118816e-03,  9.70829612e-05,
    -2.50408771e-03,  2.67723739e-03,  1.28968880e-04,
    -1.25406732e-03, -7.78307195e-03,  4.65415094e-04,
    -6.77331216e-03,  5.83355784e-06, -7.46204986e-03,
    2.79709665e-03,  2.65259651e-04, -4.86151089e-03,
    9.07678667e-05, -9.86897362e-03,  8.31694950e-04,
    -7.30557944e-03, -1.27246592e-04,  4.47773980e-03,
    -1.67805475e-04,  9.45333969e-03, -2.06194837e-05,
    1.19741653e-02]],

    [[7.30659454e-02,  6.26644064e-04, -6.45042986e-05,
      -2.44371069e-03, -8.71619020e-02, -2.97978698e-03,
      -5.70290239e-02, -4.88288484e-03,  1.81396370e-02,
      -1.49746749e-02, -1.82596238e-03, -3.73852432e-03,
      1.91679528e-03,  3.46388382e-03,  9.45765979e-04,
      6.35821093e-03,  4.43337556e-02, -1.14045984e-03,
      4.79787393e-02, -2.69629492e-03,  3.30809021e-02,
      3.90751032e-03, -7.69518614e-03, -1.00509094e-03,
      -1.83497970e-02,  1.09524242e-02,  3.03376250e-05,
      5.84822874e-03,  1.28574628e-03,  1.31931818e-03,
      -1.62226350e-03, -2.42913519e-03, -2.51710886e-03,
      -1.46265067e-03,  9.64475618e-05, -1.55335427e-03,
      -8.35208072e-03,  1.14634507e-04, -1.15803123e-02,
      9.78385907e-04, -1.45041153e-02,  2.11820605e-03,
      -1.11267735e-02, -2.54739831e-03,  1.13908925e-03,
      -1.58677391e-03,  6.85953527e-03, -4.07763058e-03,
      8.15545468e-03]],

    [[6.06366544e-02, -2.86155218e-03, -6.31169176e-04,
      2.39112903e-02, -8.10810515e-02,  6.08200360e-04,
      -5.06141009e-02, -2.06508995e-03, -1.61198389e-02,
      -1.83721383e-03, -7.99761006e-04, -4.98098056e-04,
      6.80259319e-04, -1.43673956e-02,  5.60409075e-04,
      -1.55892906e-02,  3.52407019e-02,  1.52343110e-03,
      4.21572957e-02,  1.87781266e-03,  3.20393070e-02,
      1.71999179e-03,  8.40048303e-03,  1.82572535e-04,
      1.77166894e-02,  5.35407360e-03, -1.26213948e-03,
      7.51220125e-04, -9.24301077e-04, -9.34498808e-04,
      -8.12227912e-04,  7.45251831e-03, -1.46771071e-03,
      7.26425049e-03, -2.49284089e-04,  7.85839012e-03,
      -5.55945668e-03, -3.07526270e-04, -9.91274872e-03,
      2.33305790e-04, -1.34808479e-02,  7.95748091e-04,
      -1.14669773e-02, -1.89505175e-03, -4.30439514e-03,
      -2.42432697e-04, -4.67979922e-03, -1.23980121e-03,
      -6.26678862e-03]]],


    [[[4.68592306e-02,  3.61461743e-03, -7.63514670e-04,
     -1.20844533e-02, -2.12680062e-02,  9.29568778e-03,
     -2.01531071e-02,  3.47516906e-03,  9.20440534e-03,
     -5.46795536e-03,  1.59709356e-04, -1.53637043e-03,
     -2.87913528e-04,  6.47466282e-03, -4.50224823e-04,
     1.07221387e-02,  1.27142040e-02,  1.29577853e-03,
     2.05155038e-02, -1.90391848e-02,  1.09376471e-02,
     1.49402131e-03, -9.46249960e-03,  9.19890098e-04,
     -5.18554206e-03,  4.58351245e-05, -1.76770467e-04,
     1.37229706e-03,  5.83527846e-04,  9.67807760e-04,
     1.16870730e-03, -3.93367403e-03,  1.84726513e-03,
     -4.60773077e-03, -1.23348402e-04, -7.24725612e-03,
     -1.76239341e-03,  1.04030103e-03, -4.23162632e-03,
     8.57213815e-04, -6.38065732e-03,  1.90766279e-05,
     -5.94726402e-04,  3.32327855e-03, -1.41881029e-03,
     8.57485896e-04,  1.63106010e-03,  2.71103567e-03,
     2.36989013e-03]],

     [[5.90628671e-02,  7.12337359e-03,  6.30805066e-04,
       -5.89538262e-04, -4.37513131e-02, -7.76500224e-04,
       -3.43137507e-02,  5.36402775e-03,  1.64261405e-03,
       -1.49954433e-02, -1.53570457e-03, -4.66620624e-03,
       1.74906011e-04,  1.35081847e-03,  1.88758144e-03,
       1.86557039e-03,  1.29785439e-02,  1.47604347e-03,
       2.23300761e-02, -1.19166709e-02,  2.09856438e-02,
       7.91100937e-03, -1.17660610e-02, -3.37538181e-03,
       -1.61214712e-02,  9.81557298e-03,  9.29820184e-05,
       7.44981371e-03,  3.81985318e-04,  2.48233403e-03,
       4.68702466e-04, -2.03452776e-03, -2.59054263e-03,
       8.00222286e-04, -1.51345425e-03,  1.81863005e-03,
       2.16841328e-03, -4.22872432e-04, -6.79604466e-03,
       6.29856690e-03, -8.17551116e-03,  5.05505647e-03,
       -1.05657360e-02, -2.98331814e-03, -3.59175521e-03,
       4.73267756e-03,  5.64775497e-03, -1.33188152e-03,
       5.08498298e-03]],

     [[4.97741267e-02,  3.08713766e-03,  5.63873392e-04,
       1.55436843e-02, -3.80921784e-02,  2.91715226e-03,
       -2.50003788e-02, -5.73311922e-03,  4.61819744e-04,
       -1.07811659e-02, -9.32497997e-04, -3.14809198e-03,
       9.03481742e-04, -7.94237810e-03,  1.94605341e-04,
       -8.87043651e-03, -4.64460095e-03,  7.54078202e-03,
       2.16862677e-02,  7.15296228e-03,  2.22150527e-02,
       -2.14696419e-03, -1.08946943e-03, -5.87122761e-04,
       -2.62994270e-03,  9.15782450e-03,  1.61327436e-04,
       5.93658958e-03, -3.08842666e-04,  1.49215900e-03,
       -1.28381218e-03,  4.03265153e-03, -2.26367799e-03,
       4.64427521e-03, -4.83266613e-04,  5.48291770e-03,
       1.11924666e-02, -2.16552214e-04,  2.52305299e-03,
       1.40712050e-03, -5.92827841e-03,  1.91162035e-03,
       -8.85321885e-03, -3.83274815e-03, -5.31446078e-03,
       -3.26814596e-04, -1.33576089e-03, -4.25520553e-04,
       1.38644799e-03]]],

    [[[
      1.33088596e-02,  7.70245330e-03,  9.03457852e-04,
      -4.11949105e-03, -4.39007513e-03,  2.52064292e-03,
      -6.03218056e-03,  1.13561199e-03,  9.42679670e-04,
      -9.34460087e-04,  2.41541137e-03, -5.82004266e-04,
      -3.41451676e-03,  1.14922086e-03,  4.54078257e-04,
      2.27080762e-03,  2.60575889e-03,  9.58289863e-04,
      4.55610130e-03, -5.43882630e-03,  2.91891493e-03,
      1.00431022e-03, -2.53372884e-03, -3.86116404e-05,
      -1.87465687e-03,  5.32383426e-04,  1.50538019e-04,
      9.05098395e-04, -1.81109635e-03, -1.69890726e-04,
      2.60153827e-03, -1.12953050e-03,  1.06985723e-03,
      -1.62234962e-03,  2.15486359e-04, -1.12075310e-03,
      -1.54880131e-04,  1.26322377e-04, -1.06276650e-03,
      4.80723343e-04, -1.65165470e-03,  1.03662292e-03,
      -6.90509683e-04,  1.34792802e-04, -6.62758017e-04,
      6.82414480e-04,  5.65946760e-04,  5.43906885e-04,
      8.88275606e-04]],

     [[1.69216413e-02,  8.84666010e-03,  8.79326427e-04,
       -1.15188140e-03, -8.48558842e-03,  1.44055512e-03,
       -8.69017052e-03,  9.04357052e-04, -3.34932934e-04,
       -5.36503671e-03,  1.06440860e-03, -2.62392070e-03,
       -2.00387650e-03, -2.19755205e-04,  1.05876307e-03,
       -1.70799645e-03,  1.29642088e-03,  1.17827494e-03,
       5.66355890e-03, -3.51558336e-03,  5.59002356e-03,
       8.86688817e-04, -2.01804999e-03, -3.48552502e-04,
       -2.69504812e-03,  2.38875030e-03,  3.96558766e-04,
       2.72303048e-03, -1.03172620e-03,  1.79526273e-03,
       2.04984828e-03, -7.73159626e-04,  1.58370808e-04,
       2.60501679e-04, -9.53109540e-04,  5.62474486e-04,
       1.49585605e-03, -4.40141423e-05, -7.77367586e-04,
       9.91113015e-04, -1.78421857e-03,  1.38476900e-03,
       -2.39602862e-03, -4.47369469e-04, -1.53124355e-03,
       9.33497953e-04,  7.39396498e-04, -2.10889604e-04,
       1.11924543e-03]],

     [[1.32409122e-02,  6.01101256e-03,  7.43026309e-04,
       4.56297819e-03, -8.77641953e-03,  7.22086091e-04,
       -6.91051977e-03, -4.05665172e-04,  3.24728365e-04,
       -7.13127007e-03,  6.72168797e-04, -2.20440201e-03,
       4.07174840e-04, -2.47174339e-03, -2.38993843e-04,
       -2.79616112e-03, -9.28663607e-04,  1.61242764e-03,
       5.14579103e-03,  3.25095461e-04,  5.38503992e-03,
       8.93433421e-05, -1.16181579e-03, -3.91830597e-04,
       -1.78770414e-03,  2.16618425e-03,  1.02836085e-03,
       3.74908286e-03,  1.19529788e-04,  1.99549249e-03,
       -4.90335513e-04,  8.27447594e-04, -7.07318268e-04,
       1.03643921e-03, -3.29578680e-04,  6.04670460e-04,
       2.37059976e-03,  2.06921931e-04,  4.51941221e-04,
       7.50580440e-04, -1.43936576e-03,  5.88831780e-04,
       -2.45795081e-03, -7.40358468e-04, -1.21437997e-03,
       2.45072224e-04,  2.64311350e-04, -1.81628898e-04,
       6.73057957e-04]]]])

# 3D array with slices 2-7 with values from 1-6 (with borders of 0)
ref_in_labels = np.zeros((10, 10, 10), dtype=np.uint16)
for i in range(2, 8):
    ref_in_labels[2:8, 2:8, i] = i-1

# Same array with all odd slices are set to 0
ref_out_labels = copy.deepcopy(ref_in_labels)
for i in range(1, 8, 2):
    ref_out_labels[ref_out_labels == i] = 0

# mri-info log.txt output file from freesurfer input
xform = ['Volume information for mni__mask.nii.gz', 'type: nii',
         'dimensions: 193 x 229 x 193',
         'voxel sizes: 1.000000, 1.000000, 1.000000',
         'type: SHORT (4)', 'fov: 193.000', 'dof: 1',
         'xstart: -96.5, xend: 96.5', 'ystart: -114.5, yend: 114.5',
         'zstart: -96.5, zend: 96.5',
         'TR: 0.0 msec, TE: 0.0 msec, TI: 0.0 msec, flip angle: 0.0 degrees',
         'nframes: 1', 'PhEncDir: UNKNOWN', 'FieldStrength: 0.000000',
         'ras xform present',
         'xform info: x_r = 1.0000, y_r = 0.0000, z_r = 0.0000, c_r = 0.5000',
         ': x_a = 0.0000, y_a = 1.0000, z_a = 0.0000, c_a = -17.5000',
         ': x_s = 0.0000, y_s = 0.0000, z_s = 1.0000, c_s = 18.5000',
         'Orientation   : RAS', 'Primary Slice Direction: axial',
         '', 'voxel to ras transform:',
         '1.0000   0.0000   0.0000   -96.0000',
         '0.0000   1.0000   0.0000  -132.0000',
         '0.0000   0.0000   1.0000   -78.0000',
         '0.0000   0.0000   0.0000     1.0000',
         '', 'voxel-to-ras determinant 1',
         '', 'ras to voxel transform:',
         '1.0000   0.0000   0.0000    96.0000',
         '0.0000   1.0000   0.0000   132.0000',
         '0.0000   0.0000   1.0000    78.0000',
         '0.0000   0.0000   0.0000     1.0000']

# Reference matrix for xform file
xform_matrix_ref = np.array(((1, 0, 0, 0.5), (0, 1, 0, -17.5),
                             (0, 0, 1, 18.5), (0, 0, 0, 1)))
