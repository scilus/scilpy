# -*- coding: utf-8 -*-

import copy

import numpy as np

# 3x3x1 grid of fODF taken from the outside of the backwards 'C'
# in the FiberCup. Order 8, descoteaux07 basis.
fodf_3x3_order8_descoteaux07 = np.asarray([[[
    [0.26286387, -0.336828, -0.00369634, -0.25474626,
     -0.01061569,  0.29750797,  0.03732642,  0.01171304,
     0.16143565,  0.00787683,  0.14300859,  0.01041067,
     -0.13926704, -0.00285504, -0.28675956,  0.06106967,
     -0.00251915, -0.0103068, -0.00626346, -0.05204236,
     -0.00324461, -0.0468456, -0.00444966,  0.04529396,
     0.00119645,  0.07706978,  0.00584123,  0.08920382]],

    [[0.27447942, -0.38676834, -0.02799141, -0.23060161,
      -0.03448979,  0.09528257,  0.25290385, -0.01982788,
      0.22237155,  0.00135294,  0.13581508,  0.01650201,
      -0.0275899,  0.00186949, -0.09112225, -0.08496156,
      0.00396445, -0.07162198,  0.00324492, -0.07831519,
      0.00616271, -0.05209329, -0.01479937,  0.01713125,
      -0.02268516,  0.04751123, -0.03049234,  0.06638705]],

    [[0.27134237, -0.4307746,  0.0035063, -0.2592252,
      -0.00330402, -0.15647785,  0.21888971,  0.00334128,
      0.22812255,  0.01228249,  0.16825177,  0.00471007,
      0.08927008,  0.00575425,  0.19901836, -0.04885881,
      -0.00579403, -0.07190462, -0.00737415, -0.08707161,
      -0.00195517, -0.06621928, -0.00356173, -0.03289294,
      -0.00356576, -0.06258938, -0.00665118, -0.09943768]]],


    [[[0.15886374,  0.01589506,  0.06487983, -0.02096088,
       0.02011732,  0.00589444,  0.03856898,  0.00757658,
       0.05849233, -0.11192703,  0.00713574, -0.00371081,
       -0.0244258,  0.0117896,  0.03056652, -0.01305971,
       0.00679529, -0.01269033, -0.00467887, -0.01755827,
       -0.00761302,  0.02157611,  0.02873131, -0.01170345,
       0.00136947, -0.00745852,  0.02145799,  0.00045532]],

     [[0.17820162, -0.08854709, -0.0138819, -0.08386812,
       0.04722548, -0.03020687,  0.03683474,  0.0020233,
       0.02984233, -0.07024448,  0.04935116,  0.05288185,
       -0.06069153, -0.02227145, -0.08536565, -0.00739656,
       -0.00208759, -0.03538536,  0.04175738, -0.01890082,
       0.03184003, -0.04322833, -0.0197769, -0.01709824,
       0.03408453,  0.03452914, -0.00768105,  0.02879811]],

     [[0.17783499, -0.08317029,  0.02127749, -0.05431161,
       -0.0426516,  0.00668156, -0.10225131,  0.05116061,
       0.05691102,  0.06157963,  0.08037782, -0.0264888,
       0.0032487,  0.00127227, -0.00224557,  0.08135595,
       -0.00129513,  0.04060476, -0.00118032, -0.00987782,
       0.00490772, -0.03195551, -0.01908543, -0.03024822,
       -0.00608355, -0.01933366,  0.00161467, -0.00429689]]],

    [[[0.,  0.,  0.,  0.,
       0.,  0.,  0.,  0.,
       0.,  0.,  0.,  0.,
       0.,  0.,  0.,  0.,
       0.,  0.,  0.,  0.,
       0.,  0.,  0.,  0.,
       0.,  0.,  0.,  0.]],

     [[0.,  0.,  0.,  0.,
       0.,  0.,  0.,  0.,
       0.,  0.,  0.,  0.,
       0.,  0.,  0.,  0.,
       0.,  0.,  0.,  0.,
       0.,  0.,  0.,  0.,
       0.,  0.,  0.,  0.]],

     [[0.,  0.,  0.,  0.,
       0.,  0.,  0.,  0.,
       0.,  0.,  0.,  0.,
       0.,  0.,  0.,  0.,
       0.,  0.,  0.,  0.,
       0.,  0.,  0.,  0.,
       0.,  0.,  0.,  0.]]]])

fodf_3x3_order8_descoteaux07_filtered_bilateral = np.asarray([[[[
    5.99904145e-02, -7.74841521e-03, -8.85743552e-04,
    -2.43733904e-02, -6.71300622e-02,  1.40698629e-03,
    -5.02532006e-02, -1.31764043e-03,  4.39820686e-02,
    3.04767348e-03, -2.60659751e-03,  1.19609175e-03,
    2.45643515e-03,  1.60415663e-02, -3.71781262e-04,
    1.72503732e-02,  1.87847737e-02,  1.81510421e-03,
    3.45741639e-02, -4.08627879e-03,  2.70963242e-02,
    2.48334799e-03, -2.08282714e-02, -5.04963363e-05,
    -4.04026968e-02, -4.17118816e-03,  9.70829612e-05,
    -2.50408771e-03,  2.67723739e-03,  1.28968880e-04,
    -1.25406732e-03, -7.78307195e-03,  4.65415094e-04,
    -6.77331216e-03,  5.83355784e-06, -7.46204986e-03,
    2.79709665e-03,  2.65259651e-04, -4.86151089e-03,
    9.07678667e-05, -9.86897362e-03,  8.31694950e-04,
    -7.30557944e-03, -1.27246592e-04,  4.47773980e-03,
    -1.67805475e-04,  9.45333969e-03, -2.06194837e-05,
    1.19741653e-02]],

    [[7.30659454e-02,  6.26644064e-04, -6.45042986e-05,
      -2.44371069e-03, -8.71619020e-02, -2.97978698e-03,
      -5.70290239e-02, -4.88288484e-03,  1.81396370e-02,
      -1.49746749e-02, -1.82596238e-03, -3.73852432e-03,
      1.91679528e-03,  3.46388382e-03,  9.45765979e-04,
      6.35821093e-03,  4.43337556e-02, -1.14045984e-03,
      4.79787393e-02, -2.69629492e-03,  3.30809021e-02,
      3.90751032e-03, -7.69518614e-03, -1.00509094e-03,
      -1.83497970e-02,  1.09524242e-02,  3.03376250e-05,
      5.84822874e-03,  1.28574628e-03,  1.31931818e-03,
      -1.62226350e-03, -2.42913519e-03, -2.51710886e-03,
      -1.46265067e-03,  9.64475618e-05, -1.55335427e-03,
      -8.35208072e-03,  1.14634507e-04, -1.15803123e-02,
      9.78385907e-04, -1.45041153e-02,  2.11820605e-03,
      -1.11267735e-02, -2.54739831e-03,  1.13908925e-03,
      -1.58677391e-03,  6.85953527e-03, -4.07763058e-03,
      8.15545468e-03]],

    [[6.06366544e-02, -2.86155218e-03, -6.31169176e-04,
      2.39112903e-02, -8.10810515e-02,  6.08200360e-04,
      -5.06141009e-02, -2.06508995e-03, -1.61198389e-02,
      -1.83721383e-03, -7.99761006e-04, -4.98098056e-04,
      6.80259319e-04, -1.43673956e-02,  5.60409075e-04,
      -1.55892906e-02,  3.52407019e-02,  1.52343110e-03,
      4.21572957e-02,  1.87781266e-03,  3.20393070e-02,
      1.71999179e-03,  8.40048303e-03,  1.82572535e-04,
      1.77166894e-02,  5.35407360e-03, -1.26213948e-03,
      7.51220125e-04, -9.24301077e-04, -9.34498808e-04,
      -8.12227912e-04,  7.45251831e-03, -1.46771071e-03,
      7.26425049e-03, -2.49284089e-04,  7.85839012e-03,
      -5.55945668e-03, -3.07526270e-04, -9.91274872e-03,
      2.33305790e-04, -1.34808479e-02,  7.95748091e-04,
      -1.14669773e-02, -1.89505175e-03, -4.30439514e-03,
      -2.42432697e-04, -4.67979922e-03, -1.23980121e-03,
      -6.26678862e-03]]],


    [[[4.68592306e-02,  3.61461743e-03, -7.63514670e-04,
     -1.20844533e-02, -2.12680062e-02,  9.29568778e-03,
     -2.01531071e-02,  3.47516906e-03,  9.20440534e-03,
     -5.46795536e-03,  1.59709356e-04, -1.53637043e-03,
     -2.87913528e-04,  6.47466282e-03, -4.50224823e-04,
     1.07221387e-02,  1.27142040e-02,  1.29577853e-03,
     2.05155038e-02, -1.90391848e-02,  1.09376471e-02,
     1.49402131e-03, -9.46249960e-03,  9.19890098e-04,
     -5.18554206e-03,  4.58351245e-05, -1.76770467e-04,
     1.37229706e-03,  5.83527846e-04,  9.67807760e-04,
     1.16870730e-03, -3.93367403e-03,  1.84726513e-03,
     -4.60773077e-03, -1.23348402e-04, -7.24725612e-03,
     -1.76239341e-03,  1.04030103e-03, -4.23162632e-03,
     8.57213815e-04, -6.38065732e-03,  1.90766279e-05,
     -5.94726402e-04,  3.32327855e-03, -1.41881029e-03,
     8.57485896e-04,  1.63106010e-03,  2.71103567e-03,
     2.36989013e-03]],

     [[5.90628671e-02,  7.12337359e-03,  6.30805066e-04,
       -5.89538262e-04, -4.37513131e-02, -7.76500224e-04,
       -3.43137507e-02,  5.36402775e-03,  1.64261405e-03,
       -1.49954433e-02, -1.53570457e-03, -4.66620624e-03,
       1.74906011e-04,  1.35081847e-03,  1.88758144e-03,
       1.86557039e-03,  1.29785439e-02,  1.47604347e-03,
       2.23300761e-02, -1.19166709e-02,  2.09856438e-02,
       7.91100937e-03, -1.17660610e-02, -3.37538181e-03,
       -1.61214712e-02,  9.81557298e-03,  9.29820184e-05,
       7.44981371e-03,  3.81985318e-04,  2.48233403e-03,
       4.68702466e-04, -2.03452776e-03, -2.59054263e-03,
       8.00222286e-04, -1.51345425e-03,  1.81863005e-03,
       2.16841328e-03, -4.22872432e-04, -6.79604466e-03,
       6.29856690e-03, -8.17551116e-03,  5.05505647e-03,
       -1.05657360e-02, -2.98331814e-03, -3.59175521e-03,
       4.73267756e-03,  5.64775497e-03, -1.33188152e-03,
       5.08498298e-03]],

     [[4.97741267e-02,  3.08713766e-03,  5.63873392e-04,
       1.55436843e-02, -3.80921784e-02,  2.91715226e-03,
       -2.50003788e-02, -5.73311922e-03,  4.61819744e-04,
       -1.07811659e-02, -9.32497997e-04, -3.14809198e-03,
       9.03481742e-04, -7.94237810e-03,  1.94605341e-04,
       -8.87043651e-03, -4.64460095e-03,  7.54078202e-03,
       2.16862677e-02,  7.15296228e-03,  2.22150527e-02,
       -2.14696419e-03, -1.08946943e-03, -5.87122761e-04,
       -2.62994270e-03,  9.15782450e-03,  1.61327436e-04,
       5.93658958e-03, -3.08842666e-04,  1.49215900e-03,
       -1.28381218e-03,  4.03265153e-03, -2.26367799e-03,
       4.64427521e-03, -4.83266613e-04,  5.48291770e-03,
       1.11924666e-02, -2.16552214e-04,  2.52305299e-03,
       1.40712050e-03, -5.92827841e-03,  1.91162035e-03,
       -8.85321885e-03, -3.83274815e-03, -5.31446078e-03,
       -3.26814596e-04, -1.33576089e-03, -4.25520553e-04,
       1.38644799e-03]]],

    [[[
      1.33088596e-02,  7.70245330e-03,  9.03457852e-04,
      -4.11949105e-03, -4.39007513e-03,  2.52064292e-03,
      -6.03218056e-03,  1.13561199e-03,  9.42679670e-04,
      -9.34460087e-04,  2.41541137e-03, -5.82004266e-04,
      -3.41451676e-03,  1.14922086e-03,  4.54078257e-04,
      2.27080762e-03,  2.60575889e-03,  9.58289863e-04,
      4.55610130e-03, -5.43882630e-03,  2.91891493e-03,
      1.00431022e-03, -2.53372884e-03, -3.86116404e-05,
      -1.87465687e-03,  5.32383426e-04,  1.50538019e-04,
      9.05098395e-04, -1.81109635e-03, -1.69890726e-04,
      2.60153827e-03, -1.12953050e-03,  1.06985723e-03,
      -1.62234962e-03,  2.15486359e-04, -1.12075310e-03,
      -1.54880131e-04,  1.26322377e-04, -1.06276650e-03,
      4.80723343e-04, -1.65165470e-03,  1.03662292e-03,
      -6.90509683e-04,  1.34792802e-04, -6.62758017e-04,
      6.82414480e-04,  5.65946760e-04,  5.43906885e-04,
      8.88275606e-04]],

     [[1.69216413e-02,  8.84666010e-03,  8.79326427e-04,
       -1.15188140e-03, -8.48558842e-03,  1.44055512e-03,
       -8.69017052e-03,  9.04357052e-04, -3.34932934e-04,
       -5.36503671e-03,  1.06440860e-03, -2.62392070e-03,
       -2.00387650e-03, -2.19755205e-04,  1.05876307e-03,
       -1.70799645e-03,  1.29642088e-03,  1.17827494e-03,
       5.66355890e-03, -3.51558336e-03,  5.59002356e-03,
       8.86688817e-04, -2.01804999e-03, -3.48552502e-04,
       -2.69504812e-03,  2.38875030e-03,  3.96558766e-04,
       2.72303048e-03, -1.03172620e-03,  1.79526273e-03,
       2.04984828e-03, -7.73159626e-04,  1.58370808e-04,
       2.60501679e-04, -9.53109540e-04,  5.62474486e-04,
       1.49585605e-03, -4.40141423e-05, -7.77367586e-04,
       9.91113015e-04, -1.78421857e-03,  1.38476900e-03,
       -2.39602862e-03, -4.47369469e-04, -1.53124355e-03,
       9.33497953e-04,  7.39396498e-04, -2.10889604e-04,
       1.11924543e-03]],

     [[1.32409122e-02,  6.01101256e-03,  7.43026309e-04,
       4.56297819e-03, -8.77641953e-03,  7.22086091e-04,
       -6.91051977e-03, -4.05665172e-04,  3.24728365e-04,
       -7.13127007e-03,  6.72168797e-04, -2.20440201e-03,
       4.07174840e-04, -2.47174339e-03, -2.38993843e-04,
       -2.79616112e-03, -9.28663607e-04,  1.61242764e-03,
       5.14579103e-03,  3.25095461e-04,  5.38503992e-03,
       8.93433421e-05, -1.16181579e-03, -3.91830597e-04,
       -1.78770414e-03,  2.16618425e-03,  1.02836085e-03,
       3.74908286e-03,  1.19529788e-04,  1.99549249e-03,
       -4.90335513e-04,  8.27447594e-04, -7.07318268e-04,
       1.03643921e-03, -3.29578680e-04,  6.04670460e-04,
       2.37059976e-03,  2.06921931e-04,  4.51941221e-04,
       7.50580440e-04, -1.43936576e-03,  5.88831780e-04,
       -2.45795081e-03, -7.40358468e-04, -1.21437997e-03,
       2.45072224e-04,  2.64311350e-04, -1.81628898e-04,
       6.73057957e-04]]]])

fodf_3x3_order8_descoteaux07_filtered_cosine = np.array([[
    [[1.10403600e-01, -1.56274168e-02, -1.76220261e-03, -4.06611449e-02,
      -1.30363567e-01,  3.75744696e-03, -9.97133892e-02, -3.49429274e-03,
      9.52583150e-02,  8.20238612e-03, -4.89889718e-03,  2.97695306e-03,
      4.70504991e-03,  2.74152194e-02, -1.06442787e-03,  3.09297306e-02,
      3.78406501e-02,  4.40385732e-03,  6.97472214e-02, -5.22356452e-03,
      5.54510683e-02,  4.19701656e-03, -4.61628754e-02,  1.04670478e-03,
      -9.23817078e-02, -1.08910148e-02,  5.21920978e-04, -6.08726863e-03,
      5.44869381e-03, -2.53482527e-04, -2.27573225e-03, -1.40288007e-02,
      1.35667761e-03, -1.30331232e-02,  5.35207622e-04, -1.63039610e-02,
      7.97932344e-03,  8.02639457e-04, -1.21136261e-02, -1.83430175e-03,
      -2.54608366e-02,  9.91489623e-04, -1.97747572e-02, -1.75031223e-03,
      1.49128199e-02, -1.43106403e-03,  2.66094509e-02,  8.57021815e-04,
      3.30743534e-02]],

    [[1.40072235e-01,  3.36392275e-03, -1.12255448e-04, -5.78225308e-03,
      -1.77192188e-01, -6.19144118e-03, -1.17119585e-01, -1.16353192e-02,
      3.66205780e-02, -3.46907611e-02, -3.57179047e-03, -9.03952453e-03,
      3.77892854e-03,  7.63422898e-03,  1.62939211e-03,  1.45448683e-02,
      9.98680216e-02, -2.60934868e-03,  1.02401140e-01, -3.99776516e-03,
      6.98372955e-02,  8.57505830e-03, -1.55541774e-02, -6.67052505e-04,
      -3.87320367e-02,  2.70807684e-02,  4.61517902e-04,  1.48157281e-02,
      2.48281726e-03,  3.77428961e-03, -3.20783604e-03, -5.32528133e-03,
      -4.66592653e-03, -4.11151389e-03,  1.53491240e-04, -6.28303818e-03,
      -2.60040931e-02,  9.76421739e-04, -3.20749919e-02,  6.17639701e-04,
      -3.80348770e-02,  3.50055436e-03, -2.89460088e-02, -6.21961773e-03,
      6.33647814e-03, -3.64798932e-03,  1.61175330e-02, -8.68729069e-03,
      1.87904410e-02]],

    [[1.14020750e-01, -6.87045764e-03, -1.14232450e-03,  4.11661189e-02,
      -1.63423278e-01,  1.42638757e-03, -1.02391114e-01, -3.10274637e-03,
      -4.14102976e-02, -7.65200269e-05, -1.22479669e-03,  1.44271152e-04,
      1.02909411e-03, -2.53524591e-02,  8.46680097e-04, -2.91525407e-02,
      8.15595775e-02,  2.62140564e-03,  8.88886643e-02,  3.47353540e-03,
      6.60543440e-02,  4.57053464e-03,  2.22276194e-02,  1.59968571e-03,
      4.74753501e-02,  9.57052289e-03, -2.72297788e-03,  7.60147678e-04,
      -2.24030127e-03, -2.25223735e-03, -1.58726069e-03,  1.44355725e-02,
      -2.65302865e-03,  1.43794907e-02, -7.26650570e-04,  1.72575124e-02,
      -2.26407370e-02, -3.96339977e-05, -2.79391904e-02,  1.96495129e-04,
      -3.42417083e-02,  5.69135891e-04, -2.83188289e-02, -3.90851596e-03,
      -9.86179763e-03, -1.53911048e-03, -1.44494506e-02, -3.56561464e-03,
      -2.28537982e-02]]],

    [[[7.26406236e-02,  7.02981930e-03, -1.87881430e-03, -1.61256813e-02,
     -2.64719814e-02,  1.79623468e-02, -2.81063801e-02,  6.54603124e-03,
     1.45408540e-02, -1.01358115e-02,  4.89154209e-04, -2.90726497e-03,
     -5.52737463e-04,  8.21197934e-03, -1.38576779e-03,  1.91516929e-02,
     1.90580115e-02,  1.39116265e-03,  3.21379718e-02, -3.41384306e-02,
     1.56080311e-02,  2.17425083e-03, -1.61882394e-02,  2.30982768e-03,
     -4.68867105e-03, -6.71668742e-04, -1.23223614e-04,  2.34797057e-03,
     1.21306862e-03,  1.70700484e-03,  2.32198084e-03, -5.41906023e-03,
     4.33958103e-03, -8.72831333e-03,  4.65559442e-04, -1.77434743e-02,
     -3.67747484e-03,  2.22363618e-03, -6.92884020e-03,  1.54291482e-03,
     -1.17597007e-02, -7.95446846e-04, -9.29108890e-05,  6.00740874e-03,
     -8.13945278e-04,  6.46410176e-04,  3.25235814e-03,  5.35093467e-03,
     1.94505156e-03]],

     [[9.81325940e-02,  1.52165204e-02,  1.24419995e-03, -1.28939516e-03,
       -7.51292526e-02, -4.42181788e-03, -6.18455506e-02,  1.09682359e-02,
       1.47464674e-03, -3.31177366e-02, -2.92832122e-03, -1.02011317e-02,
       3.94651358e-04,  2.74508980e-03,  3.55769102e-03,  4.53198680e-03,
       1.65537934e-02,  6.31128591e-04,  3.60410320e-02, -2.02268925e-02,
       3.71610204e-02,  1.50104427e-02, -2.10404071e-02, -6.66322009e-03,
       -2.82880695e-02,  2.37099397e-02,  4.67322046e-04,  1.69550184e-02,
       7.12799550e-04,  5.70549692e-03,  8.82880626e-04, -3.97702624e-03,
       -4.87365758e-03,  1.15246875e-03, -2.71843590e-03,  1.70523580e-03,
       8.22004027e-03, -2.16495266e-03, -1.35291214e-02,  1.12046159e-02,
       -1.70833051e-02,  9.56991767e-03, -2.20789814e-02, -5.21140434e-03,
       -5.63453210e-03,  9.14118089e-03,  1.07848139e-02, -2.44076209e-03,
       7.20372163e-03]],

     [[7.82262155e-02,  4.89325589e-03,  9.69035921e-04,  2.48817773e-02,
       -5.77909247e-02,  5.15396685e-03, -3.73859556e-02, -1.12652597e-02,
       1.46133523e-03, -1.93929247e-02, -1.66098338e-03, -5.40552612e-03,
       1.90785108e-03, -1.27736588e-02, -2.63140561e-04, -1.64589849e-02,
       -1.67926849e-02,  1.37226384e-02,  3.40286811e-02,  1.60456988e-02,
       3.66665622e-02, -4.95865979e-03, -8.81294607e-04, -9.27511404e-04,
       -5.56159406e-03,  1.85807717e-02,  4.28397297e-05,  1.14440177e-02,
       -8.44202079e-04,  2.83058074e-03, -2.77968111e-03,  7.24897169e-03,
       -3.92705015e-03,  8.88560041e-03, -1.14740758e-03,  1.25959122e-02,
       2.28839936e-02, -6.30383042e-04,  6.79235888e-03,  2.74534443e-03,
       -1.08549693e-02,  2.89646379e-03, -1.59780244e-02, -7.49181391e-03,
       -9.15354118e-03, -1.60175812e-03, -1.81015916e-03, -7.74073756e-04,
       5.32445729e-03]]],

    [[[1.34755663e-02,  1.28413970e-02,  1.49938841e-03, -6.47475638e-03,
     2.52029988e-03,  4.88968824e-03, -5.42289754e-03,  1.60941684e-03,
     -2.21852068e-03,  2.07330837e-03,  4.86536226e-03,  1.66978774e-04,
     -6.71214109e-03,  1.27351141e-03,  9.82399935e-04,  2.22677827e-03,
     2.71719965e-03,  2.06634356e-03,  2.94252961e-03, -8.67336125e-03,
     3.55625935e-04,  1.36775123e-03, -2.08127408e-03,  2.52009045e-04,
     -1.49716310e-04, -3.07585778e-04,  1.29094098e-04, -1.78327891e-04,
     -3.55467543e-03, -1.03702801e-03,  5.01705916e-03, -1.46068291e-03,
     2.29931595e-03, -2.32968172e-03,  7.43670432e-04, -6.92986861e-04,
     -1.00498143e-03,  2.95173070e-05, -1.53450925e-03,  3.21191049e-04,
     -1.58863466e-03,  2.65016963e-03, -4.11708281e-04, -7.87924032e-04,
     -8.33831423e-04,  1.07967881e-03,  2.63612367e-04,  9.87115809e-04,
     1.21380213e-03]],

     [[1.61478356e-02,  1.43728777e-02,  1.93974718e-03, -3.32623522e-03,
       -1.17420191e-03,  3.21700718e-03, -8.75686341e-03,  1.37117517e-03,
       -4.32829335e-03, -4.42773363e-03,  2.38329302e-03, -3.33902113e-03,
       -4.12497515e-03, -6.89667443e-05,  2.41897821e-03, -4.26942050e-03,
       -1.74191884e-03,  1.81570155e-03,  3.17867090e-03, -5.10889033e-03,
       4.49678511e-03, -2.60849304e-04,  1.84832760e-05,  4.61673598e-04,
       -1.52379129e-03,  9.91300908e-04,  9.15433033e-04,  2.68803221e-03,
       -2.02188630e-03,  2.73531219e-03,  3.98791591e-03, -1.49808319e-03,
       3.31828949e-04,  6.51188325e-04, -1.63160178e-03,  2.33668240e-03,
       2.93338642e-03, -5.06191672e-05, -1.03964494e-04,  3.87231978e-04,
       -8.64134554e-04,  2.56989460e-03, -2.72089308e-03, -5.28755828e-04,
       -2.52279382e-03,  1.50003583e-03,  2.73936763e-04, -7.08454308e-04,
       1.54615336e-03]],

     [[1.21073977e-02,  9.65647748e-03,  1.40513870e-03,  5.96978239e-03,
       -5.83388001e-03,  1.18491063e-03, -7.42142705e-03, -1.61753221e-04,
       2.31758132e-03, -1.01991745e-02,  1.25833161e-03, -3.28820299e-03,
       9.77997070e-04, -3.33627171e-03, -7.64652162e-04, -4.00396819e-03,
       -4.28747212e-03,  2.06971554e-03,  4.22446175e-03,  1.39004952e-03,
       5.11484010e-03, -2.51029606e-04, -1.53415978e-03, -9.05476137e-04,
       -3.72103599e-03,  1.62807768e-03,  2.07196281e-03,  5.50544884e-03,
       3.46282883e-04,  3.54274790e-03, -1.15406623e-03,  1.05391112e-03,
       -1.00296491e-03,  9.83314237e-04, -5.52227484e-04, -2.60564565e-04,
       3.63180002e-03,  1.15833727e-03,  2.31403574e-03,  6.13974106e-04,
       -7.09616975e-04, -1.19250538e-04, -3.14249677e-03, -2.51516937e-04,
       -7.67022089e-04, -3.86918453e-04,  7.29633770e-04, -1.56990164e-04,
       9.27285029e-04]]]])

# Bingham fit
fodf_3x3_bingham = np.array([[
    [[[0.8865956, -1.01305598,  0.3570712,  4.31487453, -4.09539035,
       1.50380415, -1.08597013],
      [0.,  0.,  0.,  0.,  0., 0.,  0.],
      [0.,  0.,  0.,  0.,  0., 0.,  0.]]],

    [[[0.85683347, -3.44257945,  0.24681098,  2.7063325,  3.0255078,
       -0.39132021,  3.88427259],
      [0.09353532, -2.07887656, -0.23646431,  2.54845777,  3.35888907,
       -12.87836086,  1.54502972],
      [0.,  0.,  0.,  0.,  0., 0.,  0.]]],

    [[[0.95034369,  3.82616343,  0.66640788,  2.10370133, -2.29257285,
       -0.44777004,  4.31152262],
      [0.,  0.,  0.,  0.,  0., 0.,  0.],
      [0.,  0.,  0.,  0.,  0., 0.,  0.]]]],

    [[[[0.18908378, -1.3861731,  3.03919906, -1.22601547,  1.29995979,
        2.13770894,  3.82944086],
       [0.12418191,  2.74008198, -0.06444388, -1.57097804,  3.1965494,
        0.87367118,  5.53954571],
       [0.12104527,  3.61536971, -2.68105852, -1.64809093,  3.14649051,
        4.40167953, -0.25813741]]],

     [[[0.27522583, -3.48810133,  0.8774683,  1.78047152,  2.43352883,
        -0.35692355,  4.94340074],
       [0.20108258,  4.56868628,  3.66376182,  0.03988314, -3.4448441,
           4.25196219,  4.01761794],
       [0.16118525,  1.50428971,  2.4830825,  0.17002741,  1.20848685,
        -1.22853768,  7.24969027]]],

     [[[0.2612878,  4.36835975,  2.85751351,  2.79826519, -2.49064595,
        -1.38304902,  5.30046931],
       [0.23787563, -0.23406115, -0.25916585,  3.62612255,  5.29582601,
           -3.54583996,  0.08841027],
       [0.14373517,  2.05462185,  1.39279777,  0.56035226,  3.45503345,
        -6.17007375,  2.66774636]]]],

    [[[[0.,  0.,  0.,  0.,  0., 0.,  0.],
       [0.,  0.,  0.,  0.,  0., 0.,  0.],
       [0.,  0.,  0.,  0.,  0., 0.,  0.]]],

     [[[0.,  0.,  0.,  0.,  0., 0.,  0.],
       [0.,  0.,  0.,  0.,  0., 0.,  0.],
       [0.,  0.,  0.,  0.,  0., 0.,  0.]]],

     [[[0.,  0.,  0.,  0.,  0., 0.,  0.],
       [0.,  0.,  0.,  0.,  0., 0.,  0.],
       [0.,  0.,  0.,  0.,  0., 0.,  0.]]]]])

# Bingham array as spherical functions
fodf_3x3_bingham_sf = np.array([[[[
    [1.59484877e-01, 1.18932451e-02, 1.17911602e-02, 1.19221973e-02,
     1.79084769e-01, 1.73800247e-01],
    [0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
     0.00000000e+00, 0.00000000e+00],
    [0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
     0.00000000e+00, 0.00000000e+00]]],

    [[[4.61621144e-02, 2.12595934e-02, 6.34163521e-03, 1.00096474e-02,
       2.58251608e-01, 1.95556145e-01],
      [1.00636347e-02, 4.07760320e-05, 3.24542499e-02, 3.66369494e-03,
       2.92196637e-05, 1.47902411e-06],
      [0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
       0.00000000e+00, 0.00000000e+00]]],

    [[[1.89202646e-02, 7.72759893e-02, 1.04786067e-02, 7.41384901e-03,
       2.44206672e-01, 2.13048219e-01],
      [0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
       0.00000000e+00, 0.00000000e+00],
      [0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
       0.00000000e+00, 0.00000000e+00]]]],

    [[[[6.07104883e-02, 2.16483588e-02, 2.62426053e-03, 4.32045162e-02,
        2.64859330e-03, 9.99567222e-03],
       [4.88698419e-03, 9.58808359e-03, 2.20309972e-04, 2.60379323e-03,
        1.22570327e-02, 4.96320594e-02],
       [6.83268085e-04, 1.77794115e-03, 7.85952079e-02, 6.50364754e-03,
        1.38528228e-03, 4.95163615e-03]]],

     [[[3.03020624e-02, 5.84492588e-03, 1.15539675e-03, 3.57417939e-03,
        5.23586737e-02, 5.93138461e-02],
       [5.84873154e-04, 2.04800390e-03, 4.99198602e-02, 1.37601372e-03,
        2.97576042e-04, 2.80472189e-02],
       [1.58809156e-02, 1.10644235e-01, 2.39822852e-04, 2.29946460e-03,
        1.09010927e-02, 1.66605591e-03]]],

     [[[6.85402639e-04, 8.28014763e-02, 1.18689001e-03, 9.40716640e-04,
        1.29906371e-02, 1.64458673e-02],
       [7.72311584e-02, 4.09197783e-04, 5.93833482e-03, 4.46406166e-03,
        2.73251646e-02, 1.57738201e-02],
       [1.26632583e-02, 6.09482433e-04, 6.09099345e-03, 1.21231123e-01,
        8.59146396e-03, 3.02273873e-04]]]],

    [[[[0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
        0.00000000e+00, 0.00000000e+00],
       [0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
        0.00000000e+00, 0.00000000e+00],
       [0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
        0.00000000e+00, 0.00000000e+00]]],

     [[[0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
        0.00000000e+00, 0.00000000e+00],
       [0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
        0.00000000e+00, 0.00000000e+00],
       [0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
        0.00000000e+00, 0.00000000e+00]]],

     [[[0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
        0.00000000e+00, 0.00000000e+00],
       [0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
        0.00000000e+00, 0.00000000e+00],
       [0.00000000e+00, 0.00000000e+00, 0.00000000e+00, 0.00000000e+00,
        0.00000000e+00, 0.00000000e+00]]]]])

fodf_3x3_bingham_fd = np.array([
    [[[1.47125431, 0., 0.]],
     [[1.35616136, 0.10115714, 0.]],
     [[1.50423449, 0., 0.]]],

    [[[0.35457353, 0.2050584, 0.17187861]],
     [[0.43043627, 0.22323813, 0.25806502]],
     [[0.30886279, 0.36314695, 0.24672844]]],

    [[[0., 0., 0.]],
     [[0., 0., 0.]],
     [[0., 0., 0.]]]]
)

fodf_3x3_bingham_fs = np.array([
    [[[1.65944238, 0., 0.]],
     [[1.58275955, 1.08148601, 0.]],
     [[1.58283209, 0., 0.]]],

    [[[1.87521918, 1.65127433, 1.41995313]],
     [[1.56393849, 1.11018135, 1.60104613]],
     [[1.18207888, 1.52662528, 1.71654884]]],

    [[[0., 0., 0.]],
     [[0., 0., 0.]],
     [[0., 0., 0.]]]]
)

fodf_3x3_bingham_ff = np.array([
    [[[1., 0., 0.]],
     [[0.9305868, 0.0694132, 0.]],
     [[1., 0., 0.]]],

    [[[0.48471418, 0.28032187, 0.23496396]],
     [[0.47210449, 0.24484861, 0.2830469]],
     [[0.33618151, 0.39526707, 0.26855142]]],

    [[[0., 0., 0.]],
     [[0., 0., 0.]],
     [[0., 0., 0.]]]]
)

fodf_3x3_bingham_peaks = np.array([
    [[[[-0.34397547, -0.93897366, -0.00305593],
       [0.,  0.,  0.],
       [0.,  0.,  0.]]],

     [[[0.09314371,  0.9952668,  0.02771716],
       [0.73461195,  0.26645789,  0.62397555],
       [0.,  0.,  0.]]],

     [[[0.17614917, -0.98432624, -0.0085624],
       [0.,  0.,  0.],
       [0.,  0.,  0.]]]],

    [[[[0.87605833,  0.22821013, -0.42478458],
       [0.04979924, -0.99058828,  0.12749469],
       [0.30605549, -0.16378166,  0.9378196]]],

     [[[0.2244257,  0.97366253, -0.04017949],
       [0.3659656, -0.46513121,  0.80605344],
       [0.84032072, -0.49375814, -0.22374984]]],

     [[[0.53356359, -0.84522153,  0.03017378],
       [0.5527576,  0.82792627,  0.09485319],
       [0.37296054, -0.18433035, -0.90935293]]]],

    [[[[0.,  0.,  0.],
       [0.,  0.,  0.],
       [0.,  0.,  0.]]],

     [[[0.,  0.,  0.],
       [0.,  0.,  0.],
       [0.,  0.,  0.]]],

     [[[0.,  0.,  0.],
       [0.,  0.,  0.],
       [0.,  0.,  0.]]]]]
)

# 3D array with slices 2-7 with values from 1-6 (with borders of 0)
ref_in_labels = np.zeros((10, 10, 10), dtype=np.uint16)
for i in range(2, 8):
    ref_in_labels[2:8, 2:8, i] = i-1

# Same array with all odd slices are set to 0
ref_out_labels = copy.deepcopy(ref_in_labels)
for i in range(1, 8, 2):
    ref_out_labels[ref_out_labels == i] = 0

# mri-info log.txt output file from freesurfer input
xform = ['Volume information for mni__mask.nii.gz', 'type: nii',
         'dimensions: 193 x 229 x 193',
         'voxel sizes: 1.000000, 1.000000, 1.000000',
         'type: SHORT (4)', 'fov: 193.000', 'dof: 1',
         'xstart: -96.5, xend: 96.5', 'ystart: -114.5, yend: 114.5',
         'zstart: -96.5, zend: 96.5',
         'TR: 0.0 msec, TE: 0.0 msec, TI: 0.0 msec, flip angle: 0.0 degrees',
         'nframes: 1', 'PhEncDir: UNKNOWN', 'FieldStrength: 0.000000',
         'ras xform present',
         'xform info: x_r = 1.0000, y_r = 0.0000, z_r = 0.0000, c_r = 0.5000',
         ': x_a = 0.0000, y_a = 1.0000, z_a = 0.0000, c_a = -17.5000',
         ': x_s = 0.0000, y_s = 0.0000, z_s = 1.0000, c_s = 18.5000',
         'Orientation   : RAS', 'Primary Slice Direction: axial',
         '', 'voxel to ras transform:',
         '1.0000   0.0000   0.0000   -96.0000',
         '0.0000   1.0000   0.0000  -132.0000',
         '0.0000   0.0000   1.0000   -78.0000',
         '0.0000   0.0000   0.0000     1.0000',
         '', 'voxel-to-ras determinant 1',
         '', 'ras to voxel transform:',
         '1.0000   0.0000   0.0000    96.0000',
         '0.0000   1.0000   0.0000   132.0000',
         '0.0000   0.0000   1.0000    78.0000',
         '0.0000   0.0000   0.0000     1.0000']

# Reference matrix for xform file
xform_matrix_ref = np.array(((1, 0, 0, 0.5), (0, 1, 0, -17.5),
                             (0, 0, 1, 18.5), (0, 0, 0, 1)))
